<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>活動詳情</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        main {
            min-height: calc(100vh - 70px);
        }

        /* Set the size of the div element that contains the map */
        #map {
            height: 300px;
            /* The height is 400 pixels */
            width: 300px;
            /* The width is the width of the web page */
        }

        .join {
            position: sticky;
            bottom: 0;
        }

        /* 留言捲軸 */
        #scroll {
            overflow-y: scroll;
            max-height: 400px;
        }

        /* 留言頭像跟人名inline */
        .list-group {
            display: inline;
        }


        .category-icon {
            font-size: 2rem; /* Example size */
        }

        .category-card {
            border: none;
            transition: transform 0.3s;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
<div class="container">
    <header
            class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">
        <div class="col-md-3 mb-2 mb-md-0">
            <a href="activity.html" class="d-inline-flex link-body-emphasis text-decoration-none">
                <span class="fs-4">做伙</span>
            </a>
        </div>

        <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
            <li><a href="activity.html" class="nav-link px-2 link-secondary">首頁</a></li>
            <li><a href="join.html" class="nav-link px-2 link-secondary">瀏覽活動</a></li>
            <li><a href="create.html" class="nav-link px-2 link-secondary">舉辦活動</a></li>
            <li><a href="rent.html" class="nav-link px-2 link-secondary">場地租借</a></li>
            <li><a href="customer.html" class="nav-link px-2 link-secondary">FAQs</a></li>
            <li><a href="about.html" class="nav-link px-2 link-secondary">關於我們</a></li>
        </ul>

        <div class="col-md-3 text-end">
            <button type="button" class="btn btn-outline-primary me-2"><a class="nav-link" href="#"
                                                                          data-bs-toggle="modal"
                                                                          data-bs-target="#loginModal">登入</a></button>
            <button type="button" class="btn btn-primary"><a class="nav-link" href="register.html">註冊</a></button>
        </div>
    </header>
</div>

<div class="container">
    <div class="text-bark text-center py-4">
        <div class="shadow p-3 mb-5 bg-body rounded">
            <h1>活動名稱</h1>
        </div>
    </div>

    <main class="my-4">
        <div class="row">
            <div class="col-md-8">
                <img src="" class="img-thumbnail" alt="...">
                <section>
                    <h2>活動詳情</h2>
                    <p>活動描述和詳細資訊</p>
                    <p>開始时间：2023-12-01 10:00 AM</p>
                    <p>结束时间：2023-12-01 4:00 PM</p>
                    <h3>活動訊息</h3>
                    <span>活動內容</span>
                </section>
            </div>
            <div class="col-md-4 border" id="right-div">
                <aside>
                    <h2>活動訊息</h2>
                    <p>地點：活動場地</p>
                    <p>主辦方：活動主辦方</p>
                    <p>聯繫信箱：contact@example.com</p>
                </aside>
                <div id="map"></div>
            </div>
        </div>

        <div class="mt-5 w-50">
            <div class="mt-3">
                <p>留言區</p>
                <div class="card w-100" id="scroll">
                    <div id="comments" class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group">
                                <img src="." style="width: 35px; height: auto;" alt="小白">
                            </li>
                            <li class="list-group-item">留言一</li>
                            <div class="d-flex">
                                <li class="list-group">4天前</li>
                                <li class="list-group ms-auto"><img src=""><a href="#" id="report">檢舉</a></li>
                            </div>
                        </ul>
                    </div>
                </div>
            </div>
            <div>
                <button id="pagination" type="button">查看更多</button>
            </div>
            <form id="commentsform" class="row g-3">
                <label for="comment" class="visually-hidden">留言</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="comment" placeholder="輸入您的留言">
                    <button type="submit" class="btn btn-outline-primary">留言</button>
                </div>
            </form>
        </div>


        <div class="container mt-4 border" id="people">
            <div class="row">
                <div>
                    <h5>參與者(99)</h5>
                </div>
                <div class="col-md-2 mb-3">
                    <div class="shadow p-3">
                        <img src="" class="img-fluid d-block mx-auto"
                             style="width: 60px; height: auto">
                    </div>
                </div>
                <div class="col-md-2 mb-3">
                    <div class="shadow p-3">
                        <img src="" class="img-fluid d-block mx-auto"
                             style="width: 60px; height: auto">
                    </div>
                </div>
                <div class="col-md-2 mb-3">
                    <div class="shadow p-3">
                        <img src="" class="img-fluid d-block mx-auto"
                             style="width: 60px; height: auto">
                    </div>
                </div>
                <div class="col-md-2 mb-3">
                    <div class="shadow p-3">
                        <img src="" class="img-fluid d-block mx-auto"
                             style="width: 60px; height: auto">
                    </div>
                </div>
            </div>
        </div>

        <div class="p-3 join">
            <div class="text-bark">
                <div class="shadow p-4 bg-body rounded">
                    <button type="button" class="btn btn-danger btn-lg mx-3" onclick="signup()">報名活動</button>
                    <button type="button" class="btn btn-outline-success btn-lg">分享活動</button>
                </div>
            </div>
        </div>
</div>
</main>
</div>

<div class="container">
    <footer class="py-3 my-4">
        <ul class="nav justify-content-center border-bottom pb-3 mb-3">
            <li class="nav-item"><a href="activity.html" class="nav-link px-2 text-muted">首頁</a></li>
            <li class="nav-item"><a href="customer.html" class="nav-link px-2 text-muted">客服中心</a></li>
            <li class="nav-item"><a href="about.html" class="nav-link px-2 text-muted">關於我們</a></li>
        </ul>
        <p class="text-center text-muted">© 2023 Company, Inc</p>
    </footer>
</div>

<!-- 登入選項的Modal 彈窗 -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">會員登入</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- 在這裡加入登入表單的 HTML 代碼 -->
                <form>
                    <div class="mb-3">
                        <label for="username" class="form-label">帳號：</label>
                        <input type="text" class="form-control" id="username" name="username" placeholder="輸入您的帳號"
                               required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">密碼：</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="password" name="password"
                                   placeholder="輸入您的密碼" required>
                            <a href="#" class="input-group-text" id="forgotPasswordLink">忘記密碼</a>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">登入</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous">
</script>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
        crossorigin="anonymous"></script>
<script src="
https://cdn.jsdelivr.net/npm/sweetalert2@11.10.2/dist/sweetalert2.all.min.js
"></script>
<link href="
https://cdn.jsdelivr.net/npm/sweetalert2@11.10.2/dist/sweetalert2.min.css
" rel="stylesheet">

<script src="googlemap.js"></script>

<script>

    $(function () {
        //進畫面後顯示所有留言
        $.ajax({
            url: '/comments',
            type: 'GET',
            dataType: 'json',
            success: function (comments) {
                var commentsHTML = "";
                comments.forEach(function (comment) {
                    commentsHTML +=
                        '<ul class="list-group list-group-flush">' +
                        '<li class="list-group"><img src="" style="width: 35px; height: auto;" alt="小白"></li>' +
                        '<li class="list-group-item">' + comment.comContent + '</li>' +
                        '<div class="d-flex">' +
                        '<li class="list-group">' + comment.comTime + '</li>' +
                        '<li class="list-group ms-auto"><img src=""><a href="#">檢舉</a></li>' +
                        '</div>' +
                        '</ul>';
                    $("#comments").html(commentsHTML);

                    // memid 用來顯示會員的大頭照
                });
            },
            error: function (xhr, status, error) {
                console.error("Error:" + status + " " + error);
            }
        });
        //新增留言
        $("#commentsform").on("submit", function (e) {
            e.preventDefault();

            // actId = window.location.pathname.split('/')[2]; // 假設活動ID在URL的第三个段落中

            // 假設從伺服器獲取memId值並儲存到localStorage
            // localStorage.setItem('memId', '從伺服器獲取的值');

            // var userMemId = localStorage.getItem('memId');
            // if (!userMemId) {
            //     console.error("未登入");
            //     return;
            // }

            var commentData = {
                actId: 1, //改動態抓
                memId: 1, //改動態抓 userMemId
                // comReplyId:null,
                comContent: $("#comment").val()
            };

            $.ajax({
                url: '/comments',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(commentData),
                dataType: 'json',
                success: function (comments) {
                    $("#comment").val("")

                    var commentsHTML = "";
                    comments.forEach(function (comment) {
                        commentsHTML +=
                            '<ul class="list-group list-group-flush">' +
                            '<li class="list-group"><img src="" style="width: 35px; height: auto;" alt="小白"></li>' +
                            '<li class="list-group-item">' + comment.comContent + '</li>' +
                            '<div class="d-flex">' +
                            '<li class="list-group">' + comment.comTime + '</li>' +
                            '<li class="list-group ms-auto"><img src=""><a href="#">檢舉</a></li>' +
                            '</div>' +
                            '</ul>';
                        $("#comments").html(commentsHTML);

                        // memid 會員編號 用來顯示會員的大頭照
                    });
                },
                error: function (xhr, status, error) {
                    console.error("Error:" + status + " " + error);
                }
            });
        });
    });

    //檢舉
    $("#report").on("click", function (e) {
        e.preventDefault();

        var commentReportData = {
            comId: 1, //改動態抓
            memId: 1, //改動態抓 userMemId
            repTitle:標題用選單的方式給使用者選,
            repContent:內容從輸入框抓,
            // comContent: $("#comment").val()
        };

        $.ajax({
           url:"/c",
           type:"POST",
           data:JSON.stringify(commentReportData),
           success:function(response){
                alert("檢舉成功!");
           },
            error:function(xhr, status, error){
                alert("檢舉失敗");
            }
        });
    });

    //報名活動按鈕
    function signup() {
        Swal.fire({
            title: '人數',
            input: 'text',
            inputPlaceholder: '報名人數',
            inputValidator: (value) => {
                if (!value) {
                    return '請輸入人數!!'
                }
                if (value > 10) {
                    return '不準報名這麼多人!!';
                }
                if (isNaN(value)) {
                    return '叫你輸入數字!!';
                }
            },
            showCancelButton: true,
            confirmButtonText: '送出',
            cancelButtonText: '取消',
        }).then((result) => {
            if (result.isConfirmed && result.value) {

                // 假設從伺服器獲取memId值並儲存到localStorage
                // localStorage.setItem('memId', '從伺服器獲取的值');

                // var userMemId = localStorage.getItem('memId');
                // if (!userMemId) {
                //     console.error("未登入");
                //     return;
                // }

                // actId = window.location.pathname.split('/')[2]; // 假設活動ID在URL的第三个段落中

                var numberOfPeople = {
                    memId: 1, //改動態抓
                    actId: 1, //改動態抓 userMemId
                    regTotal: result.value
                };
                $.ajax({
                    url: '/a',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(numberOfPeople),
                    success: function (actReg) {
                        Swal.fire('報名成功!，您報名的人數：' + actReg.regTotal);
                    },
                    error: function (xhr, status, error) {
                        Swal.fire("報名失敗，請再多試試");
                    }
                });
            }
        });
    }

</script>

</body>

</html>